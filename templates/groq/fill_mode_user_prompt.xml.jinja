{% if visual_selection %}
QUERY: {{user_query}}

SELECTED CODE:
```{{current_buffer_filetype}}
{{visual_selection}}
```
{% else %}
{{user_query}}
{% endif %}

{% if current_buffer_path %}
CONTEXT: {{ current_buffer_path }}
{% endif %}
{% if current_buffer_context %}
```{{current_buffer_filetype}}
{{ current_buffer_context }}
```
{% endif %}
